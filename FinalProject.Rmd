---
title: "R Notebook"
author: "Eric Schneider"
output: html_notebook
---

## Front Matter

```{r}
# clean up workspace environment
rm(list = ls())

# all packages used for the assignment
library(dplyr)
library(DataComputing)
library(rvest)
library(tidyr)
library(ggplot2)
library(mosaic)
library(cowplot)
library(magrittr)
```


## Load in Data
```{r}
page <- "https://www.basketball-reference.com/leaders/pts_per_g_career.html"
tableList <- page %>%
  read_html() %>%
  html_nodes(css = "table") %>%
  html_table(fill = TRUE)
allTime <- (tableList[[3]])
```

```{r}
page1 <- "https://www.basketball-reference.com/leagues/NBA_2019_per_game.html"
tableList1 <- page1 %>%
  read_html() %>%
  html_nodes(css = "table") %>%
  html_table(fill = TRUE)
g20189 <- (tableList1[[1]])
```

```{r}
page2 <- "https://www.basketball-reference.com/leagues/NBA_2018_per_game.html"
tableList2 <- page2 %>%
  read_html() %>%
  html_nodes(css = "table") %>%
  html_table(fill = TRUE)
g20178 <- (tableList2[[1]])
```

```{r}
page3 <- "https://www.basketball-reference.com/leagues/NBA_2017_per_game.html"
tableList3 <- page3 %>%
  read_html() %>%
  html_nodes(css = "table") %>%
  html_table(fill = TRUE)
g20167 <- (tableList3[[1]])
```

# Inspect new imported data tables
```{r}
head(g20167)
head(allTime)
names(allTime)
glimpse(g20189)
```

# Guiding question: Look at Stats by position over the 3 years and compare what positions are best in what areas. Also compare one all time stat 


# Add year variable to tables to be able to determine stats by year when joined
```{r}
g20189 <- mutate(g20189, year = '2018-9')
g20178 <- mutate(g20178, year = '2017-8')
g20167 <- mutate(g20167, year = '2016-7')
```

# Join the 3 yearly tables 
```{r}
allYears <- full_join(g20167,g20178)
allYears <- full_join(allYears,g20189)
allYears[, c(30)] <- sapply(allYears[, c(30)], as.numeric)
```

# Seperate allYears table by position

```{r}
SG <- filter(allYears, grepl(pattern = "SG", Pos))
PF <- filter(allYears, grepl(pattern = "PF", Pos))
C <- filter(allYears, grepl(pattern = "C", Pos))
SF <- filter(allYears, grepl(pattern = "SF", Pos))
PG <- filter(allYears, grepl(pattern = "PG", Pos))
```

# Gets average of 6 big stats by Position
```{r}
target <- c("C", "PG", "SG", "PF", "SF")

points <- allYears %>%
filter(Pos %in% target) %>%
group_by(Pos) %>%
summarise(PPG = mean(as.numeric(PTS))) 


assists <- allYears %>%
filter(Pos %in% target) %>%
group_by(Pos) %>%
summarise(APG = mean(as.numeric(AST))) 


steals <- allYears %>%
filter(Pos %in% target) %>%
group_by(Pos) %>%
summarise(SPG = mean(as.numeric(STL))) 


blocks <- allYears %>%
filter(Pos %in% target) %>%
group_by(Pos) %>%
summarise(BPG = mean(as.numeric(BLK))) 


turnover <- allYears %>%
filter(Pos %in% target) %>%
group_by(Pos) %>%
summarise(TOVPG = mean(as.numeric(TOV))) 

rebounds <- allYears %>%
filter(Pos %in% target) %>%
group_by(Pos) %>%
summarise(RPG = mean(as.numeric(TRB))) 
```

# Joins individual stat tables into one containing the stats 

```{r}
all_stats <- full_join(points,assists)
all_stats <- full_join(all_stats,steals)
all_stats <- full_join(all_stats,blocks)
all_stats <- full_join(all_stats,turnover)
all_stats <- full_join(all_stats,rebounds)
all_stats <- filter(all_stats, Pos != 'Pos')
```

# Presentation Graph
```{r}
points_graph <- ggplot(data=all_stats,aes(x=Pos,y=PPG ))+geom_bar(stat='identity',position='stack', width=.9) 
assist_graph <- ggplot(data=all_stats,aes(x=Pos,y=APG ))+geom_bar(stat='identity',position='stack', width=.9) 
block_graph <- ggplot(data=all_stats,aes(x=Pos,y=BPG ))+geom_bar(stat='identity',position='stack', width=.9) 
turn_graph <- ggplot(data=all_stats,aes(x=Pos,y=TOVPG ))+geom_bar(stat='identity',position='stack', width=.9) 
steal_graph <- ggplot(data=all_stats,aes(x=Pos,y=SPG ))+geom_bar(stat='identity',position='stack', width=.9) 
rebound_graph <- ggplot(data=all_stats,aes(x=Pos,y=RPG ))+geom_bar(stat='identity',position='stack', width=.9) 

final_stats <- plot_grid(points_graph, assist_graph, steal_graph, turn_graph, block_graph, rebound_graph)
final_stats
```


```{r}
target <- c("C", "PG", "SG", "PF", "SF")
test <- select(allYears, Player, PTS, year, Pos) %>%
  filter(Pos %in% target)
```


ppg by position (count graph)
```{r}
ggplot(test, aes(x = PTS)) + geom_freqpoly(binwidth = 0.6) + aes(colour = Pos) + labs(title = "") + theme(legend.position = "right") 
```


# Comapres PPG on current vs all time
```{r}
g <- ggplot() +
geom_bar(data = allTime, aes(x = PPG), fill = 'red', alpha = 0.5, binwidth = 0.6) +
geom_bar(data = allYears, aes(x = PTS), fill = 'blue', alpha = 0.5, binwidth = 0.6) +
xlim(15,50)
suppressWarnings(print(g))
```
